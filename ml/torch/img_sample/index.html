



<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="クリップボードへコピー">
      
        <meta name="lang:clipboard.copied" content="コピーしました">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="何も見つかりませんでした">
      
        <meta name="lang:search.result.one" content="1件見つかりました">
      
        <meta name="lang:search.result.other" content="#件見つかりました">
      
        <meta name="lang:search.tokenizer" content="[\s\-　、。，．]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.2">
    
    
      
        <title>画像を扱うサンプル - 備忘録と雑記</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.3020aac5.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansjp.css">
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:600,800">
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="備忘録と雑記" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              備忘録と雑記
            </span>
            <span class="md-header-nav__topic">
              画像を扱うサンプル
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            検索キーワードを入力してください
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="備忘録と雑記" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    備忘録と雑記
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="HOME" class="md-nav__link">
      HOME
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/anaconda_cmd/" title="Anacondaコマンド集" class="md-nav__link">
      Anacondaコマンド集
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      python構文
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        python構文
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/syntax/for/" title="繰り返し for,while" class="md-nav__link">
      繰り返し for,while
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/syntax/if/" title="条件分岐 if" class="md-nav__link">
      条件分岐 if
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/syntax/list/" title="リスト" class="md-nav__link">
      リスト
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/syntax/tuple/" title="タプル" class="md-nav__link">
      タプル
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/syntax/set/" title="集合(set)" class="md-nav__link">
      集合(set)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/syntax/dict/" title="辞書(dict)" class="md-nav__link">
      辞書(dict)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/syntax/comprehension/" title="内包表記" class="md-nav__link">
      内包表記
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/syntax/typehint/" title="型注釈" class="md-nav__link">
      型注釈
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/syntax/fizzbuzz/" title="fizzbuzz" class="md-nav__link">
      fizzbuzz
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      numpy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        numpy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/numpy/random/" title="乱数生成" class="md-nav__link">
      乱数生成
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/numpy/choice/" title="ランダム選出" class="md-nav__link">
      ランダム選出
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/numpy/element/" title="配列の要素を見る" class="md-nav__link">
      配列の要素を見る
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      pandas
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        pandas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/pandas/save/" title="表形式データの保存" class="md-nav__link">
      表形式データの保存
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/pandas/csv_load/" title="csvデータの読込" class="md-nav__link">
      csvデータの読込
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/pandas/excel_load/" title="excelデータの読込" class="md-nav__link">
      excelデータの読込
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/pandas/remove/" title="重複の削除" class="md-nav__link">
      重複の削除
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/pandas/df_create/" title="DetaFrameの生成" class="md-nav__link">
      DetaFrameの生成
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/pandas/df_look/" title="DataFrameの参照" class="md-nav__link">
      DataFrameの参照
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/pandas/df_ope/" title="DataFrameの操作" class="md-nav__link">
      DataFrameの操作
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/pandas/df_show/" title="DataFrameの全表示" class="md-nav__link">
      DataFrameの全表示
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/pandas/sr_create/" title="Seriesの生成" class="md-nav__link">
      Seriesの生成
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      scipy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        scipy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/scipy/prob_density/" title="確率密度関数" class="md-nav__link">
      確率密度関数
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      matplotlib
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        matplotlib
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/matplotlib/plot/" title="matplotlibの基本" class="md-nav__link">
      matplotlibの基本
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/matplotlib/subplot/" title="複数の図をまとめて表示" class="md-nav__link">
      複数の図をまとめて表示
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/matplotlib/hist/" title="ヒストグラムの描画" class="md-nav__link">
      ヒストグラムの描画
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/matplotlib/scatter/" title="散布図を描画" class="md-nav__link">
      散布図を描画
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">
    
    <label class="md-nav__link" for="nav-2-7">
      ファイル操作
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        ファイル操作
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/file/dir_show/" title="ファイル一覧取得" class="md-nav__link">
      ファイル一覧取得
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/file/file_r/" title="ファイル読み込み" class="md-nav__link">
      ファイル読み込み
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/file/file_w/" title="ファイル書き込み" class="md-nav__link">
      ファイル書き込み
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/file/file_d/" title="ファイル削除" class="md-nav__link">
      ファイル削除
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/file/dir_create/" title="ディレクトリ作成" class="md-nav__link">
      ディレクトリ作成
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/file/dir_d/" title="ディレクトリ削除" class="md-nav__link">
      ディレクトリ削除
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/file/copy/" title="ファイルコピー" class="md-nav__link">
      ファイルコピー
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-8" type="checkbox" id="nav-2-8">
    
    <label class="md-nav__link" for="nav-2-8">
      便利ツール
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-8">
        便利ツール
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/tool/commandLine_option/" title="コマンドライン引数" class="md-nav__link">
      コマンドライン引数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/tool/progress/" title="プログレスバーの表示" class="md-nav__link">
      プログレスバーの表示
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/tool/pickle/" title="データの保存(pickle)" class="md-nav__link">
      データの保存(pickle)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/tool/exe/" title="pythonのexe化" class="md-nav__link">
      pythonのexe化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/tool/time/" title="現在時間の取得" class="md-nav__link">
      現在時間の取得
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/tool/log/" title="ログの表示" class="md-nav__link">
      ログの表示
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/tool/key/" title="キーボード操作" class="md-nav__link">
      キーボード操作
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/tool/tkinter/" title="tkinter" class="md-nav__link">
      tkinter
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-9" type="checkbox" id="nav-2-9">
    
    <label class="md-nav__link" for="nav-2-9">
      その他?
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-9">
        その他?
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/other/statistic/" title="統計基礎" class="md-nav__link">
      統計基礎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/other/tips/" title="ちょっとしたなにか" class="md-nav__link">
      ちょっとしたなにか
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-10" type="checkbox" id="nav-2-10">
    
    <label class="md-nav__link" for="nav-2-10">
      環境構築
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-10">
        環境構築
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/env/anaconda_install/" title="Anacondaによる環境構築" class="md-nav__link">
      Anacondaによる環境構築
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/env/pyenv/" title="pyenvでの環境構築" class="md-nav__link">
      pyenvでの環境構築
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      自然言語処理
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        自然言語処理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/sample/" title="サンプル" class="md-nav__link">
      サンプル
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      データの扱いと前処理
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        データの扱いと前処理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/data/prepare/" title="前処理の一連の流れ" class="md-nav__link">
      前処理の一連の流れ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/data/textdata/" title="データの読み込みと保存" class="md-nav__link">
      データの読み込みと保存
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/data/zenhan/" title="半角全角変換" class="md-nav__link">
      半角全角変換
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/data/mecab/" title="mecabの導入" class="md-nav__link">
      mecabの導入
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/data/mecab_add_userdic/" title="mecabユーザー辞書の追加" class="md-nav__link">
      mecabユーザー辞書の追加
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/data/mecab_usage/" title="mecabを使用する" class="md-nav__link">
      mecabを使用する
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/data/janome/" title="janome" class="md-nav__link">
      janome
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/data/stanford/" title="stanfordnlp" class="md-nav__link">
      stanfordnlp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/data/parse/" title="単語のパース" class="md-nav__link">
      単語のパース
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/data/stopword/" title="ストップワード除去" class="md-nav__link">
      ストップワード除去
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      統計処理
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        統計処理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/sta/tfidf/" title="TFIDF" class="md-nav__link">
      TFIDF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/sta/count/" title="単語のカウント" class="md-nav__link">
      単語のカウント
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/sta/co_matrix/" title="共起行列の作成" class="md-nav__link">
      共起行列の作成
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/sta/wordcloud/" title="ワードクラウド" class="md-nav__link">
      ワードクラウド
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      機械学習
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        機械学習
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/ml/word2vec/" title="word2vec" class="md-nav__link">
      word2vec
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/ml/kmeans/" title="kmenas" class="md-nav__link">
      kmenas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/ml/dimention/" title="次元削減" class="md-nav__link">
      次元削減
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      評価
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        評価
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nlp/eva/cos/" title="コサイン類似度" class="md-nav__link">
      コサイン類似度
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      画像
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        画像
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../image/img_show/" title="画像の読込と表示" class="md-nav__link">
      画像の読込と表示
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../image/img_load/" title="画像の読み込み" class="md-nav__link">
      画像の読み込み
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../image/img_aug/" title="画像のデータ拡張" class="md-nav__link">
      画像のデータ拡張
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../image/feature/" title="特徴量" class="md-nav__link">
      特徴量
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../image/filter/" title="フィルタ" class="md-nav__link">
      フィルタ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../image/template_matching/" title="テンプレートマッチング" class="md-nav__link">
      テンプレートマッチング
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      音声
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        音声
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../audio/general/" title="基礎" class="md-nav__link">
      基礎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../audio/feature/" title="特徴量" class="md-nav__link">
      特徴量
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      異常検知
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        異常検知
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../anormaly/base/" title="異常検知基礎" class="md-nav__link">
      異常検知基礎
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      機械学習
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        機械学習
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1">
    
    <label class="md-nav__link" for="nav-7-1">
      pytorch
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        pytorch
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../intro/" title="pytorch導入" class="md-nav__link">
      pytorch導入
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data/" title="データ取得と加工" class="md-nav__link">
      データ取得と加工
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../model/" title="モデル作成" class="md-nav__link">
      モデル作成
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../visual/" title="tensorboard可視化" class="md-nav__link">
      tensorboard可視化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensor_size/" title="テンソルサイズ操作" class="md-nav__link">
      テンソルサイズ操作
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensor_culc/" title="テンソル計算基礎" class="md-nav__link">
      テンソル計算基礎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensor2numpy/" title="tensorNumpy" class="md-nav__link">
      tensor<-->Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensor_c/" title="テンソル生成" class="md-nav__link">
      テンソル生成
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensor_o/" title="テンソル参照" class="md-nav__link">
      テンソル参照
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      scikit-learn
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        scikit-learn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../sklearn/linear/" title="線形回帰と正則化項" class="md-nav__link">
      線形回帰と正則化項
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sklearn/tree/" title="決定木" class="md-nav__link">
      決定木
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sklearn/randomforest/" title="ランダムフォレスト" class="md-nav__link">
      ランダムフォレスト
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      基礎
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        基礎
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basis/memo_prob/" title="確率メモ" class="md-nav__link">
      確率メモ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basis/memo_culculus/" title="微積分メモ" class="md-nav__link">
      微積分メモ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basis/memo_distribution/" title="確率分布メモ" class="md-nav__link">
      確率分布メモ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basis/minimize/" title="最小値を求める基礎" class="md-nav__link">
      最小値を求める基礎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basis/likelihood/" title="最尤推定" class="md-nav__link">
      最尤推定
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basis/map/" title="MAP推定" class="md-nav__link">
      MAP推定
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../basis/bayesian/" title="ベイズ推定" class="md-nav__link">
      ベイズ推定
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Markdown
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Markdown
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../markdown/mkd/" title="markdown基本" class="md-nav__link">
      markdown基本
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../markdown/math/" title="markdown数式" class="md-nav__link">
      markdown数式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../markdown/math_symbol/" title="markdown数式・記号" class="md-nav__link">
      markdown数式・記号
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../markdown/mkdocs_md/" title="markdown拡張" class="md-nav__link">
      markdown拡張
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../markdown/mkd_ex/" title="markdown例" class="md-nav__link">
      markdown例
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../markdown/mkdocs/" title="mkdocsによるwebページの公開" class="md-nav__link">
      mkdocsによるwebページの公開
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Ubuntu
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Ubuntu
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ubuntu/setting/" title="Ubuntu設定関連" class="md-nav__link">
      Ubuntu設定関連
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ubuntu/cmd/" title="Ubuntuコマンド集" class="md-nav__link">
      Ubuntuコマンド集
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ubuntu/hdd_mnt/" title="2TB以上のHDDのマウント" class="md-nav__link">
      2TB以上のHDDのマウント
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ubuntu/gpu/" title="GPU for tensorflow-gpu" class="md-nav__link">
      GPU for tensorflow-gpu
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ubuntu/login_loop/" title="ログインループの対処" class="md-nav__link">
      ログインループの対処
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Windows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Windows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../windows/shortcut/" title="ショートカットキー" class="md-nav__link">
      ショートカットキー
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../windows/wsl/" title="WSL導入" class="md-nav__link">
      WSL導入
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../windows/wsl_matplotlib/" title="WSL ~matplotlib~" class="md-nav__link">
      WSL ~matplotlib~
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../windows/wsl_python/" title="WSL python" class="md-nav__link">
      WSL python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../windows/xming_char/" title="Xming文字化け対処" class="md-nav__link">
      Xming文字化け対処
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../windows/vscode/" title="VScode設定" class="md-nav__link">
      VScode設定
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Tex
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Tex
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tex/install/" title="Texのインストール(Win)" class="md-nav__link">
      Texのインストール(Win)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      RestructuredText
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        RestructuredText
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest/fund/" title="Rest基本構文" class="md-nav__link">
      Rest基本構文
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest/admotions/" title="注意・強調" class="md-nav__link">
      注意・強調
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest/link/" title="リンク・脚注" class="md-nav__link">
      リンク・脚注
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest/math/" title="数式の挿入" class="md-nav__link">
      数式の挿入
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest/module/" title="コード・表・画像・サイドバー" class="md-nav__link">
      コード・表・画像・サイドバー
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest/other/" title="その他" class="md-nav__link">
      その他
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest/sphinx/" title="sphinxによるwebページの公開" class="md-nav__link">
      sphinxによるwebページの公開
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      アプリケーション
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        アプリケーション
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../create/pdf2md/" title="pdfからテキストを抽出する" class="md-nav__link">
      pdfからテキストを抽出する
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      音声変換の挑戦記録
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        音声変換の挑戦記録
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../voice/00_abst/" title="概要" class="md-nav__link">
      概要
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../voice/01/" title="音声基礎" class="md-nav__link">
      音声基礎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../voice/02_related/" title="関連研究" class="md-nav__link">
      関連研究
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../voice/03_proposed/" title="提案手法" class="md-nav__link">
      提案手法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      その他
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        その他
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../other/git/" title="git" class="md-nav__link">
      git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../other/rpa/" title="RPA概要" class="md-nav__link">
      RPA概要
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      ひとこと
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        ひとこと
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../blog/201910/" title="2019年10月" class="md-nav__link">
      2019年10月
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../blog/201907/" title="2019年07月" class="md-nav__link">
      2019年07月
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../blog/201906/" title="2019年06月" class="md-nav__link">
      2019年06月
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../blog/201905/" title="2019年05月" class="md-nav__link">
      2019年05月
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../blog/201904/" title="2019年04月" class="md-nav__link">
      2019年04月
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../disclaimer/" title="免責事項" class="md-nav__link">
      免責事項
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目次</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" title="概要" class="md-nav__link">
    概要
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="メイン" class="md-nav__link">
    メイン
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="データセット読込" class="md-nav__link">
    データセット読込
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transform" title="transform" class="md-nav__link">
    transform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predict" title="predict" class="md-nav__link">
    predict
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="_1">画像を扱うサンプル</h1>
<h2 id="_2">概要</h2>
<p>画像のクラス分類サンプル</p>
<p>変更の余地が大幅にあるので、閲覧注意</p>
<p>工事中です。。。</p>
<h2 id="_3">メイン</h2>
<table class="codehilitetable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128</pre></div></td><td class="code"><div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">import</span> <span style="color: #f8f8f2">torch</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torchvision.transforms</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">transforms</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torchvision.datasets</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">datasets</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torch.nn</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">nn</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torch.optim</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">optim</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">my_transform</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">BaseTransform</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">my_dataset</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">MyDataset</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">my_model</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">C3DNet,</span> <span style="color: #f8f8f2">FCNet</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">tqdm</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">tqdm</span>

<span style="color: #f92672">from</span> <span style="color: #f8f8f2">torch.utils.tensorboard</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">SummaryWriter</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">shutil</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">os</span>
<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">path</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">exists(</span><span style="color: #e6db74">&#39;./tbX&#39;</span><span style="color: #f8f8f2">):</span>
    <span style="color: #f8f8f2">shutil</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">rmtree(</span><span style="color: #e6db74">&#39;./tbX&#39;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">writer</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SummaryWriter(</span><span style="color: #e6db74">&quot;./tbX/&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #75715e"># tbxのインスタンス生成。フォルダ自動生成</span>

<span style="color: #f8f8f2">DEVICE</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">device(</span><span style="color: #e6db74">&quot;cuda:0&quot;</span> <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">cuda</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">is_available()</span> <span style="color: #66d9ef">else</span> <span style="color: #e6db74">&quot;cpu&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;使用するデバイス：&quot;</span><span style="color: #f8f8f2">,DEVICE)</span>

<span style="color: #75715e"># パラメータ各種</span>
<span style="color: #f8f8f2">BATCH_SIZE</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">4</span>
<span style="color: #f8f8f2">EPOCH</span>      <span style="color: #f92672">=</span> <span style="color: #ae81ff">75</span>

<span style="color: #75715e"># データのロードに関するパラメータ</span>
<span style="color: #f8f8f2">RESIZE</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">28</span>
<span style="color: #f8f8f2">MEAN</span>   <span style="color: #f92672">=</span> <span style="color: #f8f8f2">(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #75715e"># (0.485, 0.456, 0.406)</span>
<span style="color: #f8f8f2">STD</span>    <span style="color: #f92672">=</span> <span style="color: #f8f8f2">(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #75715e"># (0.229, 0.224, 0.225)</span>
<span style="color: #f8f8f2">data_transform</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">BaseTransform(RESIZE,</span> <span style="color: #f8f8f2">MEAN,</span> <span style="color: #f8f8f2">STD)</span>

<span style="color: #75715e"># 学習データ</span>
<span style="color: #f8f8f2">trainset</span>    <span style="color: #f92672">=</span> <span style="color: #f8f8f2">MyDataset(train_path_list,</span> <span style="color: #f8f8f2">transform</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">data_transform,</span> <span style="color: #f8f8f2">phase</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;train&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">trainloader</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">utils</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">data</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">DataLoader(trainset,</span> <span style="color: #f8f8f2">batch_size</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">BATCH_SIZE,</span> 
                                        <span style="color: #f8f8f2">shuffle</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">True,</span> <span style="color: #f8f8f2">num_workers</span><span style="color: #f92672">=</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">pin_memory</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">True)</span>
<span style="color: #75715e"># テストデータ</span>
<span style="color: #f8f8f2">testset</span>    <span style="color: #f92672">=</span> <span style="color: #f8f8f2">MyDataset(valid_path_list,</span> <span style="color: #f8f8f2">transform</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">data_transform,</span> <span style="color: #f8f8f2">phase</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;test&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">testloader</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">utils</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">data</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">DataLoader(testset,</span> <span style="color: #f8f8f2">batch_size</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">BATCH_SIZE,</span>
                                        <span style="color: #f8f8f2">shuffle</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False,</span> <span style="color: #f8f8f2">num_workers</span><span style="color: #f92672">=</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">pin_memory</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">True)</span>

<span style="color: #75715e"># モデル定義</span>
<span style="color: #f8f8f2">model</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">C3DNet()</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to(DEVICE,</span> <span style="color: #f8f8f2">non_blocking</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False)</span>
<span style="color: #75715e"># Loss関数定義</span>
<span style="color: #f8f8f2">criterion</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">nn</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">CrossEntropyLoss()</span>
<span style="color: #75715e"># optimizer定義</span>
<span style="color: #f8f8f2">optimizer</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">optim</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Adam(model</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">parameters(),</span> <span style="color: #f8f8f2">lr</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0.001</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">eps</span><span style="color: #f92672">=</span><span style="color: #ae81ff">1e-08</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">weight_decay</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span>

<span style="color: #75715e"># 学習用関数(1epoch)</span>
<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">one_train</span><span style="color: #f8f8f2">(loader,</span> <span style="color: #f8f8f2">model,</span> <span style="color: #f8f8f2">criterion,</span> <span style="color: #f8f8f2">optimizer):</span>
    <span style="color: #f8f8f2">model</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">train()</span>          <span style="color: #75715e"># モデルを学習モードに設定</span>
    <span style="color: #f8f8f2">correct</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span>            <span style="color: #75715e"># 正解率計算用の変数を宣言</span>
    <span style="color: #f8f8f2">total_loss</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0.0</span>       <span style="color: #75715e"># 1epochの損失合計</span>
    <span style="color: #f8f8f2">data_num</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">len(loader</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dataset)</span>         <span style="color: #75715e"># テストデータの総数</span>
    <span style="color: #f8f8f2">pbar</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tqdm(total</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">int(data_num</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">BATCH_SIZE))</span>  <span style="color: #75715e"># プログレスバー設定</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">batch,</span> <span style="color: #f8f8f2">(inputs,</span> <span style="color: #f8f8f2">targets)</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">enumerate(loader):</span>
        <span style="color: #f8f8f2">inputs</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inputs</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to(DEVICE,</span>  <span style="color: #f8f8f2">non_blocking</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False)</span>         <span style="color: #75715e"># データをGPUに乗せる</span>
        <span style="color: #f8f8f2">targets</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">targets</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to(DEVICE,</span> <span style="color: #f8f8f2">non_blocking</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False)</span>        <span style="color: #75715e"># ラベルをGPUに乗せる </span>
        <span style="color: #f8f8f2">optimizer</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">zero_grad()</span>               <span style="color: #75715e"># 勾配の初期化</span>
        <span style="color: #f8f8f2">outputs</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">model(inputs)</span>             <span style="color: #75715e"># モデルから出力を得る</span>
        <span style="color: #f8f8f2">loss</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">criterion(outputs,</span> <span style="color: #f8f8f2">targets)</span>  <span style="color: #75715e"># Lossの計算</span>
        <span style="color: #f8f8f2">loss</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">backward()</span>                     <span style="color: #75715e"># 勾配の計算</span>
        <span style="color: #f8f8f2">optimizer</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">step()</span>                    <span style="color: #75715e"># パラメータの更新</span>
        <span style="color: #f8f8f2">total_loss</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">loss</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">item()</span>           <span style="color: #75715e"># 表示用のロスの計算</span>
        <span style="color: #f8f8f2">_,</span> <span style="color: #f8f8f2">predicted</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">max(outputs</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">data,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>                      <span style="color: #75715e"># 確率が最大のラベルを取得</span>
        <span style="color: #f8f8f2">correct</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">predicted</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">eq(targets</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">data</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">view_as(predicted))</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">sum()</span> <span style="color: #75715e"># 正解ならば正解数をカウントアップ</span>
        <span style="color: #75715e"># if batch % 10 == 9:                 # 10バッチごとにロスを確認</span>
        <span style="color: #75715e">#     print(&#39;[%5d] loss: %.3f&#39; % (batch+1, total_loss/10))</span>
        <span style="color: #75715e">#     total_loss = 0.0                # 初期化</span>
        <span style="color: #f8f8f2">pbar</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">update(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">train_acc</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">(correct,</span> <span style="color: #f8f8f2">data_num,</span> <span style="color: #ae81ff">100.</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">correct</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">data_num)</span>
    <span style="color: #f8f8f2">pbar</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">total_loss</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">batch</span> <span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">train_acc</span>     <span style="color: #75715e"># 各バッチごとのlossの平均</span>

<span style="color: #75715e"># 検証用関数(1epoch)</span>
<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">one_valid</span><span style="color: #f8f8f2">(loader,</span> <span style="color: #f8f8f2">model,</span> <span style="color: #f8f8f2">criterion):</span>
    <span style="color: #f8f8f2">model</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">eval()</span>           <span style="color: #75715e"># モデルを推論モードに設定</span>
    <span style="color: #f8f8f2">correct</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span>            <span style="color: #75715e"># 正解率計算用の変数を宣言</span>
    <span style="color: #f8f8f2">total_loss</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0.0</span>       <span style="color: #75715e"># 1epochの損失合計</span>
    <span style="color: #f8f8f2">data_num</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">len(loader</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dataset)</span>              <span style="color: #75715e"># テストデータの総数</span>
    <span style="color: #f8f8f2">pbar</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tqdm(total</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">int(data_num</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">BATCH_SIZE))</span>  <span style="color: #75715e"># プログレスバー設定</span>
    <span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">no_grad():</span>  <span style="color: #75715e"># 推論時には勾配は不要(メモリ節約)</span>
        <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i,</span> <span style="color: #f8f8f2">(inputs,</span> <span style="color: #f8f8f2">targets)</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">enumerate(loader):</span>
            <span style="color: #f8f8f2">inputs</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inputs</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to(DEVICE,</span> <span style="color: #f8f8f2">non_blocking</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False)</span>         <span style="color: #75715e"># データをGPUに乗せる</span>
            <span style="color: #f8f8f2">targets</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">targets</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to(DEVICE,</span> <span style="color: #f8f8f2">non_blocking</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False)</span>        <span style="color: #75715e"># ラベルをGPUに乗せる</span>
            <span style="color: #f8f8f2">outputs</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">model(inputs)</span>             <span style="color: #75715e"># モデルから出力を得る </span>
            <span style="color: #f8f8f2">loss</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">criterion(outputs,</span> <span style="color: #f8f8f2">targets)</span>  <span style="color: #75715e"># Lossの計算</span>
            <span style="color: #f8f8f2">total_loss</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">loss</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">item()</span>           <span style="color: #75715e"># 表示用のロスの計算</span>
            <span style="color: #75715e"># 推論結果の取得と正誤判定</span>
            <span style="color: #f8f8f2">_,</span> <span style="color: #f8f8f2">predicted</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">max(outputs</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">data,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>                      <span style="color: #75715e"># 確率が最大のラベルを取得</span>
            <span style="color: #f8f8f2">correct</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">predicted</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">eq(targets</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">data</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">view_as(predicted))</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">sum()</span> <span style="color: #75715e"># 正解ならば正解数をカウントアップ</span>
            <span style="color: #f8f8f2">pbar</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">update(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">valid_acc</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">(correct,</span> <span style="color: #f8f8f2">data_num,</span> <span style="color: #ae81ff">100.</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">correct</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">data_num)</span>
    <span style="color: #f8f8f2">pbar</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">total_loss</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">i</span> <span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">valid_acc</span>             <span style="color: #75715e"># 各バッチごとのlossの平均</span>

<span style="color: #75715e"># tensorboardへの記録用関数</span>
<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">write_tbx</span><span style="color: #f8f8f2">(epoch,</span> <span style="color: #f8f8f2">train_loss,</span> <span style="color: #f8f8f2">valid_loss,</span> <span style="color: #f8f8f2">train_acc,</span> <span style="color: #f8f8f2">valid_acc):</span>
    <span style="color: #f8f8f2">writer</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">add_scalars(</span><span style="color: #e6db74">&#39;Loss&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;train&quot;</span><span style="color: #f8f8f2">:train_loss,</span><span style="color: #e6db74">&quot;valid&quot;</span><span style="color: #f8f8f2">:valid_loss},</span> <span style="color: #f8f8f2">epoch)</span>
    <span style="color: #f8f8f2">writer</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">add_scalars(</span><span style="color: #e6db74">&#39;Accuracy&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;train&quot;</span><span style="color: #f8f8f2">:train_acc,</span><span style="color: #e6db74">&quot;valid&quot;</span><span style="color: #f8f8f2">:valid_acc},</span> <span style="color: #f8f8f2">epoch)</span>

<span style="color: #75715e"># モデルの計算グラフをtbxに描画</span>
<span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;グラフ描画&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">data_size</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">trainset</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size()</span>
<span style="color: #f8f8f2">dummy_data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">rand(BATCH_SIZE,</span> <span style="color: #ae81ff">50</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">100</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">100</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to(DEVICE)</span> <span style="color: #75715e"># 確認用ダミーデータ</span>
<span style="color: #f8f8f2">writer</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">add_graph(model,</span> <span style="color: #f8f8f2">(dummy_data))</span>

<span style="color: #75715e"># 未学習時のモデルの性能の検証</span>
<span style="color: #f8f8f2">valid_loss,</span> <span style="color: #f8f8f2">valid_acc</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">one_valid(testloader,</span>  <span style="color: #f8f8f2">model,</span> <span style="color: #f8f8f2">criterion)</span>
<span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;未学習時のvalid_loss:&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">valid_loss</span> <span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;ValidAcc: {}/{} ({:.0f}%)&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">format(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">valid_acc))</span>

<span style="color: #75715e"># 学習開始</span>
<span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;学習開始...epoch&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">EPOCH,</span> <span style="color: #e6db74">&quot;まで&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">epoch</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">EPOCH</span><span style="color: #f92672">+</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">):</span> 
    <span style="color: #f8f8f2">train_loss,</span> <span style="color: #f8f8f2">train_acc</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">one_train(trainloader,</span> <span style="color: #f8f8f2">model,</span> <span style="color: #f8f8f2">criterion,</span> <span style="color: #f8f8f2">optimizer)</span>
    <span style="color: #f8f8f2">valid_loss,</span> <span style="color: #f8f8f2">valid_acc</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">one_valid(testloader,</span>  <span style="color: #f8f8f2">model,</span> <span style="color: #f8f8f2">criterion)</span> 
    <span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,epoch,</span><span style="color: #e6db74">&quot;epoch目: train_loss:&quot;</span><span style="color: #f8f8f2">,train_loss,</span><span style="color: #e6db74">&quot;valid_loss:&quot;</span><span style="color: #f8f8f2">,valid_loss)</span>
    <span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;TrainAcc: {}/{} ({:.0f}%)&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">format(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">train_acc),</span> <span style="color: #e6db74">&#39;ValidAcc: {}/{} ({:.0f}%)&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">format(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">valid_acc))</span>
    <span style="color: #f8f8f2">write_tbx(epoch,</span> <span style="color: #f8f8f2">train_loss,</span> <span style="color: #f8f8f2">valid_loss,</span> <span style="color: #f8f8f2">train_acc[</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">valid_acc[</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">])</span>
    <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">save({</span>
        <span style="color: #e6db74">&#39;epoch&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">epoch,</span>
        <span style="color: #e6db74">&#39;model_state_dict&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">model</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">state_dict(),</span>
        <span style="color: #e6db74">&#39;optimizer_state_dict&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">optimizer</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">state_dict(),</span>
        <span style="color: #e6db74">&#39;train_loss&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">train_loss,</span>
        <span style="color: #e6db74">&#39;valid_loss&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">valid_loss</span>
        <span style="color: #f8f8f2">},</span> <span style="color: #e6db74">&quot;./chpoint/model&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">str(epoch)</span><span style="color: #f92672">+</span><span style="color: #e6db74">&quot;.tar&quot;</span><span style="color: #f8f8f2">)</span>


<span style="color: #f8f8f2">writer</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span> <span style="color: #75715e"># tbxをclose</span>
<span style="color: #75715e"># グラフは以下で確認可能</span>
<span style="color: #75715e"># tensorboard --logdir=&quot;./tbX/&quot;</span>
</pre></div>
</td></tr></table>

<h2 id="_4">データセット読込</h2>
<p>下は実は動画用なので注意</p>
<table class="codehilitetable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre></div></td><td class="code"><div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">from</span> <span style="color: #f8f8f2">PIL</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Image,</span> <span style="color: #f8f8f2">ImageFile</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torch.utils.data</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">data</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">os</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">pathlib</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Path</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">MyDataset</span><span style="color: #f8f8f2">(data</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Dataset):</span>
    <span style="color: #e6db74">&quot;&quot;&quot;</span>
<span style="color: #e6db74">    データセットの作成</span>

<span style="color: #e6db74">    Attributes</span>
<span style="color: #e6db74">    ----------</span>
<span style="color: #e6db74">    file_list : リスト</span>
<span style="color: #e6db74">        画像のパスを格納したリスト</span>
<span style="color: #e6db74">    transform : object</span>
<span style="color: #e6db74">        前処理クラスのインスタンス</span>
<span style="color: #e6db74">    phase : &#39;train&#39; or &#39;test&#39;</span>
<span style="color: #e6db74">        学習か訓練かを設定する。</span>
<span style="color: #e6db74">    &quot;&quot;&quot;</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__init__</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">video_list,</span> <span style="color: #f8f8f2">transform</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">None,</span> <span style="color: #f8f8f2">phase</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;train&#39;</span><span style="color: #f8f8f2">):</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">video_list</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">video_list</span>  <span style="color: #75715e"># ファイルパスのリスト</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">transform</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">transform</span>  <span style="color: #75715e"># 前処理クラスのインスタンス</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">phase</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">phase</span>  <span style="color: #75715e"># train or valの指定</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__len__</span><span style="color: #f8f8f2">(self):</span>
        <span style="color: #e6db74">&#39;&#39;&#39;画像の枚数を返す&#39;&#39;&#39;</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">len(self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">video_list)</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__getitem__</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">index):</span>
        <span style="color: #e6db74">&#39;&#39;&#39;</span>
<span style="color: #e6db74">        前処理をした画像のTensor形式のデータとラベルを取得</span>
<span style="color: #e6db74">        &#39;&#39;&#39;</span>
        <span style="color: #75715e"># index番目の画像をロード</span>
        <span style="color: #f8f8f2">video_path</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">video_list[index]</span>
        <span style="color: #75715e"># print(video_path)</span>
        <span style="color: #75715e"># img = Image.open(img_path) # [高さ][幅][色RGB]</span>
        <span style="color: #f8f8f2">img_group</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">load_imgs(video_path)</span>
        <span style="color: #75715e"># 画像の前処理を実施</span>
        <span style="color: #f8f8f2">img_transformed</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">transform(img_group)</span> <span style="color: #75715e"># torch.Size([frame, 3, 224, 224])</span>
        <span style="color: #75715e"># print(img_transformed.size())</span>
        <span style="color: #75715e"># ラベルの取得</span>
        <span style="color: #f8f8f2">label</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get_label(video_path)</span> <span style="color: #75715e"># フォルダ名からラベルを取得する</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">img_transformed,</span> <span style="color: #f8f8f2">label</span>

    <span style="color: #75715e"># 画像の読み込み</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">load_imgs</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">video_path,</span> <span style="color: #f8f8f2">FRAME</span><span style="color: #f92672">=</span><span style="color: #ae81ff">50</span><span style="color: #f8f8f2">):</span>
        <span style="color: #75715e"># ファイルリストの取得</span>
        <span style="color: #f8f8f2">img_list</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sorted(list(Path(video_path)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">glob(</span><span style="color: #e6db74">&quot;*&quot;</span><span style="color: #f8f8f2">)))</span>
        <span style="color: #75715e"># print(img_list)</span>
        <span style="color: #75715e"># 画像をグループにする</span>
        <span style="color: #f8f8f2">img_group</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span>
        <span style="color: #f8f8f2">frame_num</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">len(img_list)</span>  <span style="color: #75715e"># フレーム長の取得</span>
        <span style="color: #75715e"># フレーム長を合わせる</span>
        <span style="color: #75715e"># 両端を複製する</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">frame_num</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">FRAME:</span>
            <span style="color: #f8f8f2">dframe</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">FRAME</span><span style="color: #f92672">-</span> <span style="color: #f8f8f2">frame_num</span>
            <span style="color: #f8f8f2">iframe</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">round(dframe</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">)</span>
            <span style="color: #f8f8f2">fframe</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">dframe</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">iframe</span>
            <span style="color: #f8f8f2">iframes</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #ae81ff">0</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(iframe)]</span>
            <span style="color: #f8f8f2">nframes</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[x</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(frame_num)]</span>
            <span style="color: #f8f8f2">fframes</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[frame_num</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(fframe)]</span>
            <span style="color: #f8f8f2">frames</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">iframes</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">nframes</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">fframes</span>
            <span style="color: #75715e"># print(frames)</span>
        <span style="color: #66d9ef">else</span><span style="color: #f8f8f2">:</span>
            <span style="color: #f8f8f2">frames</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[round(x</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">frame_num</span> <span style="color: #f92672">/</span> <span style="color: #f8f8f2">FRAME)</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(FRAME)]</span>
        <span style="color: #75715e"># 画像の取得</span>
        <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">ix</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">frames:</span>
            <span style="color: #f8f8f2">img</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Image</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">open(img_list[ix])</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">convert(</span><span style="color: #e6db74">&quot;L&quot;</span><span style="color: #f8f8f2">)</span>
            <span style="color: #f8f8f2">img_group</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(img)</span> 
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">img_group</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">get_label</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">video_path):</span>
        <span style="color: #75715e"># s001_001_002 : label 0 (001-1)</span>
        <span style="color: #f8f8f2">label</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">int(video_path</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split(</span><span style="color: #e6db74">&quot;_&quot;</span><span style="color: #f8f8f2">)[</span><span style="color: #f92672">-</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">])</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">1</span>
        <span style="color: #75715e"># print(video_path , &quot;label: &quot;,label)</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">label</span>
</pre></div>
</td></tr></table>

<h2 id="transform">transform</h2>
<table class="codehilitetable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e"># 入力画像の前処理のクラス</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torch</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torchvision</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">BaseTransform</span><span style="color: #f8f8f2">():</span>
    <span style="color: #e6db74">&quot;&quot;&quot;</span>
<span style="color: #e6db74">    画像のサイズをリサイズし、色を標準化する。</span>

<span style="color: #e6db74">    Attributes</span>
<span style="color: #e6db74">    ----------</span>
<span style="color: #e6db74">    resize : int</span>
<span style="color: #e6db74">        リサイズ先の画像の大きさ。</span>
<span style="color: #e6db74">    mean : (R, G, B)</span>
<span style="color: #e6db74">        各色チャネルの平均値。</span>
<span style="color: #e6db74">    std : (R, G, B)</span>
<span style="color: #e6db74">        各色チャネルの標準偏差。</span>
<span style="color: #e6db74">    &quot;&quot;&quot;</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__init__</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">resize,</span> <span style="color: #f8f8f2">mean,</span> <span style="color: #f8f8f2">std):</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">base_transform</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">transforms</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Compose([</span>
            <span style="color: #f8f8f2">torchvision</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">transforms</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Resize(resize),</span>  <span style="color: #75715e"># 短い辺の長さがresizeの大きさになる</span>
            <span style="color: #f8f8f2">torchvision</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">transforms</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">CenterCrop(resize),</span>  <span style="color: #75715e"># 画像中央をresize × resizeで切り取り</span>
            <span style="color: #f8f8f2">torchvision</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">transforms</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ToTensor(),</span>  <span style="color: #75715e"># Torchテンソルに変換</span>
            <span style="color: #f8f8f2">torchvision</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">transforms</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Normalize(mean,</span> <span style="color: #f8f8f2">std)</span>  <span style="color: #75715e"># 色情報の標準化</span>
        <span style="color: #f8f8f2">])</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__call__</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">img,</span> <span style="color: #f8f8f2">phase</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;train&#39;</span><span style="color: #f8f8f2">):</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">base_transform(img)</span>
</pre></div>
</td></tr></table>

<h2 id="predict">predict</h2>
<table class="codehilitetable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="codehilite" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">import</span> <span style="color: #f8f8f2">torch</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torchvision.transforms</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">transforms</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torchvision.datasets</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">datasets</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torch.nn</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">nn</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">torch.optim</span> <span style="color: #f92672">as</span> <span style="color: #f8f8f2">optim</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">my_transform</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">BaseTransform,</span> <span style="color: #f8f8f2">VaTransform</span>
<span style="color: #75715e"># from my_dataloader import BaseDataloader</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">my_model</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">C2DNet,</span> <span style="color: #f8f8f2">FCNet</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">tqdm</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">tqdm</span>
<span style="color: #f8f8f2">MODEL_PATH</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;model.tar&quot;</span>
<span style="color: #f8f8f2">DEVICE</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">device(</span><span style="color: #e6db74">&quot;cuda:0&quot;</span> <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">cuda</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">is_available()</span> <span style="color: #66d9ef">else</span> <span style="color: #e6db74">&quot;cpu&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;使用するデバイス：&quot;</span><span style="color: #f8f8f2">,DEVICE)</span>
<span style="color: #f8f8f2">BATCH_SIZE</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">5</span>
<span style="color: #f8f8f2">EPOCH</span>      <span style="color: #f92672">=</span> <span style="color: #ae81ff">5</span>
<span style="color: #75715e"># データのロード MNIST</span>
<span style="color: #f8f8f2">RESIZE</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">28</span>
<span style="color: #f8f8f2">MEAN</span>   <span style="color: #f92672">=</span> <span style="color: #f8f8f2">(</span><span style="color: #ae81ff">0.485</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0.456</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0.406</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">STD</span>    <span style="color: #f92672">=</span> <span style="color: #f8f8f2">(</span><span style="color: #ae81ff">0.229</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0.224</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0.225</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">data_transform</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">BaseTransform(RESIZE,</span> <span style="color: #f8f8f2">MEAN,</span> <span style="color: #f8f8f2">STD)</span>

<span style="color: #75715e"># 学習データ</span>
<span style="color: #f8f8f2">testset</span>    <span style="color: #f92672">=</span> <span style="color: #f8f8f2">MyDataset(test_path_list,</span> <span style="color: #f8f8f2">transform</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">data_transform,</span> <span style="color: #f8f8f2">phase</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;test&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">testloader</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">utils</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">data</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">DataLoader(testset,</span> <span style="color: #f8f8f2">batch_size</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">BATCH_SIZE,</span> 
                                        <span style="color: #f8f8f2">shuffle</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False,</span> <span style="color: #f8f8f2">num_workers</span><span style="color: #f92672">=</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">pin_memory</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">True)</span>
<span style="color: #75715e"># テストデータ</span>
<span style="color: #75715e"># モデルのロード</span>
<span style="color: #f8f8f2">model</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">C2DNet()</span>
<span style="color: #f8f8f2">optimizer</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">optim</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Adam(model</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">parameters(),</span> <span style="color: #f8f8f2">lr</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0.001</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">eps</span><span style="color: #f92672">=</span><span style="color: #ae81ff">1e-08</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">weight_decay</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">checkpoint</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">load(MODEL_PATH)</span>
<span style="color: #f8f8f2">model</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">load_state_dict(checkpoint[</span><span style="color: #e6db74">&#39;model_state_dict&#39;</span><span style="color: #f8f8f2">])</span>
<span style="color: #f8f8f2">optimizer</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">load_state_dict(checkpoint[</span><span style="color: #e6db74">&#39;optimizer_state_dict&#39;</span><span style="color: #f8f8f2">])</span>
<span style="color: #f8f8f2">epoch</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">checkpoint[</span><span style="color: #e6db74">&#39;epoch&#39;</span><span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">train_loss</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">checkpoint[</span><span style="color: #e6db74">&#39;train_loss&#39;</span><span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">valid_loss</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">checkpoint[</span><span style="color: #e6db74">&#39;valid_loss&#39;</span><span style="color: #f8f8f2">]</span>
<span style="color: #75715e"># Loss関数定義</span>
<span style="color: #f8f8f2">criterion</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">nn</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">CrossEntropyLoss()</span>
<span style="color: #75715e"># 評価用の設定</span>
<span style="color: #f8f8f2">model</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">eval()</span>
<span style="color: #f8f8f2">correct</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span>            <span style="color: #75715e"># 正解率計算用の変数を宣言</span>
<span style="color: #f8f8f2">total_loss</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0.0</span>       <span style="color: #75715e"># 1epochの損失合計</span>
<span style="color: #f8f8f2">data_num</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">len(testloader</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dataset)</span>              <span style="color: #75715e"># テストデータの総数</span>
<span style="color: #f8f8f2">pbar</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tqdm(total</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">int(data_num</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">BATCH_SIZE))</span>  <span style="color: #75715e"># プログレスバー設定</span>
<span style="color: #66d9ef">with</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">no_grad():</span>  <span style="color: #75715e"># 推論時には勾配は不要(メモリ節約)</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i,</span> <span style="color: #f8f8f2">(inputs,</span> <span style="color: #f8f8f2">targets)</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">enumerate(testloader):</span>
        <span style="color: #f8f8f2">inputs</span>  <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inputs</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to(DEVICE,</span> <span style="color: #f8f8f2">non_blocking</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False)</span>         <span style="color: #75715e"># データをGPUに乗せる</span>
        <span style="color: #f8f8f2">targets</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">targets</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to(DEVICE,</span> <span style="color: #f8f8f2">non_blocking</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False)</span>        <span style="color: #75715e"># ラベルをGPUに乗せる</span>
        <span style="color: #75715e"># print(targets)</span>
        <span style="color: #f8f8f2">outputs</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">model(inputs)</span>             <span style="color: #75715e"># モデルから出力を得る</span>
        <span style="color: #75715e"># print(outputs)</span>
        <span style="color: #f8f8f2">loss</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">criterion(outputs,</span> <span style="color: #f8f8f2">targets)</span>  <span style="color: #75715e"># Lossの計算</span>
        <span style="color: #f8f8f2">total_loss</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">loss</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">item()</span>           <span style="color: #75715e"># 表示用のロスの計算</span>
        <span style="color: #75715e"># 推論結果の取得と正誤判定</span>
        <span style="color: #f8f8f2">_,</span> <span style="color: #f8f8f2">predicted</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">torch</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">max(outputs</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">data,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>                      <span style="color: #75715e"># 確率が最大のラベルを取得</span>
        <span style="color: #f8f8f2">correct</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">predicted</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">eq(targets</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">data</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">view_as(predicted))</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">sum()</span> <span style="color: #75715e"># 正解ならば正解数をカウントアップ</span>
        <span style="color: #f8f8f2">pbar</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">update(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">valid_acc</span> <span style="color: #f92672">=</span>  <span style="color: #f8f8f2">(correct,</span> <span style="color: #f8f8f2">data_num,</span> <span style="color: #ae81ff">100.</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">correct</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">data_num)</span>
<span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;評価時のloss:&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">valid_loss,</span> <span style="color: #e6db74">&#39;ValidAcc: {}/{} ({:.0f}%)&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">format(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">valid_acc))</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.267712eb.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>